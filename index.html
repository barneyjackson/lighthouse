<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Menu Administration</title>
    <link rel="stylesheet" href="../shared/css/base.css" />
    <script src="build/react.js"></script>
    <script src="build/react-dom.js"></script>
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
  </head>
  <body>
    <h1>Basic Example</h1>
    <div id="container">
      <p>
        To install React, follow the instructions on
        <a href="https://github.com/facebook/react/">GitHub</a>.
      </p>
      <p>
        If you can see this, React is not working right.
        If you checked out the source from GitHub make sure to run <code>grunt</code>.
      </p>
    </div>
    <h4>Example Details</h4>
    <p>This is written in vanilla JavaScript (without JSX) and transformed in the browser.</p>
    <p>
      Learn more about React at
      <a href="https://facebook.github.io/react" target="_blank">facebook.github.io/react</a>.
    </p>
    <script type='text/babel'>

    var MenuComponent = React.createClass({

      componentWillMount: function() {
        this.setState({menu: this.props.menu, callback: this.props.callback})
      },

      handleChange: function(event) {
        console.log(this.state.menu)
        const updatedMenu = Object.assign(this.state.menu)
        updatedMenu.description = event.target.value
        this.state.callback(updatedMenu)
        this.setState({menu: updatedMenu})
      },

      handleStateChange: function(newChildMenu) {
        console.log(this.state)
        const currentMenuChildren = this.state.menu.children
        const idx = currentMenuChildren.find(function(elem) {
          return elem.id == newChildMenu.id
        })

        if (idx == -1) {
          currentMenuChildren.push(newChildMenu)
        } else {
          currentMenuChildren[idx] = newChildMenu
        }

        const updatedMenu = Object.assign(this.state.menu)
        updatedMenu.children = currentMenuChildren

        // update our menu, then update our parents
        this.setState({menu: updatedMenu})
        this.state.callback(this.state.menu)
      },

      render: function() {
        // only use state! never use props again.
        var menu = this.state.menu;
        var stack = this.state.stack;
        var handleStateChange = this.handleStateChange;
        return (
          <ol>
            <li><input type="text" onChange={this.handleChange} value={menu.description} /></li>
            {menu.children &&
              menu.children.map(function(menuItem, idx) {
                return <MenuComponent menu={menuItem} callback={handleStateChange}/>
              })
            }
          </ol>
        );
      }

    });

var MenuContainer = React.createClass({

  /*
  getInitialState: function() {
    return {};
  },

  componentDidMount: function() {
    $.ajax({
      url: "/menu",
      dataType: 'json',
      cache: false,
      success: function(data) {
        this.setState({menu: data});
      }.bind(this),
      error: function(xhr, status, err) {
        console.error(this.props.url, status, err.toString());
      }.bind(this)
    });
  },

  render: function() {
    return (
      <div>
      {
        this.state.menu &&
        <MenuComponent menu=this.state.menu />
      }
      </div>
    );
  }
  */

  handleSubmit: function(updatedMenu) {
    console.log(updatedMenu)
    console.log('are we here?')
    // callback chain of state!!
    // magically do everything!
  },

  render: function() {
    var a = {
    "description": "Some Meta Text",
    "children": [
        {"id": "a", "description": "1. Get info about food.", "children": [{"id": "d", "description": "1. More Food Info"}]},
        {"id": "b", "description": "2. Get info about housing.", "answer": "Zaatari"},
        {"id": "c", "description": "3. What's the name of this camp.", "answer": "Zaatari"}]
    }

    var stack = []

    return (
      <div>
        <MenuComponent menu={a} callback={this.handleSubmit}/>
        <button onClick={this.handleSubmit}>submit dude</button>
      </div>
    );
  }
});

ReactDOM.render(
  <MenuContainer />,
  document.getElementById('container')
);
    </script>
  </body>
</html>
